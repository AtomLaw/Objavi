#!/usr/bin/python

# Part of Objavi2, which turns html manuals into books.
# This python script generates lists of fonts in pdf and html form.
#
# Copyright (C) 2009 Douglas Bagnall
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License along
# with this program; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

import os, sys
os.chdir('..')
os.putenv("OBJAVI_PROJECT_DIR", os.getcwd())
sys.path.insert(0, os.path.abspath('./lib'))

from objavi import fontlist
from objavi import config

import cgi


def main():
    form = cgi.FieldStorage()
    script = form.getfirst('script')
    if script not in (x for x in os.listdir(config.FONT_EXAMPLE_SCRIPT_DIR) if x.isalnum()):
        script = 'latin'

    pdfname = fontlist.create_fontlist(script)

    f = open(pdfname)
    s = f.read()
    f.close()

    print "Content-type: application/pdf\nContent-length: %s\n" % (len(s),)
    print s


if __name__ == '__main__':
    main()
    sys.exit()
